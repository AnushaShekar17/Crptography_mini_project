import tkinter as tk
from tkinter import messagebox
import string

# ------------------ Playfair Cipher Functions ---------------------

def remove_duplicates(keyword):
    result = ""
    for char in keyword:
        if char not in result:
            result += char
    return result

def generate_matrix(keyword):
    keyword = keyword.upper().replace("J", "I")
    keyword = remove_duplicates(keyword)

    matrix = []
    used = set()

    for char in keyword:
        if char not in used and char in string.ascii_uppercase:
            matrix.append(char)
            used.add(char)

    for char in string.ascii_uppercase:
        if char not in used and char != "J":
            matrix.append(char)
            used.add(char)

    return [matrix[i:i+5] for i in range(0, 25, 5)]

def find_position(matrix, letter):
    for r in range(5):
        for c in range(5):
            if matrix[r][c] == letter:
                return r, c
    return None

def prepare_text(text):
    text = text.upper().replace(" ", "").replace("J", "I")
    text = ''.join(filter(str.isalpha, text))

    prepared = ""
    i = 0
    while i < len(text):
        a = text[i]
        if i + 1 < len(text):
            b = text[i+1]
            if a == b:
                prepared += a + "X"
                i += 1
            else:
                prepared += a + b
                i += 2
        else:
            prepared += a + "X"
            i += 1
    return prepared

def encrypt_pair(a, b, matrix):
    r1, c1 = find_position(matrix, a)
    r2, c2 = find_position(matrix, b)

    if r1 == r2:
        return matrix[r1][(c1 + 1) % 5] + matrix[r2][(c2 + 1) % 5]
    elif c1 == c2:
        return matrix[(r1 + 1) % 5][c1] + matrix[(r2 + 1) % 5][c2]
    else:
        return matrix[r1][c2] + matrix[r2][c1]

def decrypt_pair(a, b, matrix):
    r1, c1 = find_position(matrix, a)
    r2, c2 = find_position(matrix, b)

    if r1 == r2:
        return matrix[r1][(c1 - 1) % 5] + matrix[r2][(c2 - 1) % 5]
    elif c1 == c2:
        return matrix[(r1 - 1) % 5][c1] + matrix[(r2 - 1) % 5][c2]
    else:
        return matrix[r1][c2] + matrix[r2][c1]

def playfair_encrypt(plaintext, keyword):
    matrix = generate_matrix(keyword)
    prepared = prepare_text(plaintext)
    encrypted = ""
    for i in range(0, len(prepared), 2):
        encrypted += encrypt_pair(prepared[i], prepared[i+1], matrix)
    return encrypted

def playfair_decrypt(ciphertext, keyword):
    ciphertext = ciphertext.upper().replace(" ", "")
    ciphertext = ''.join(filter(str.isalpha, ciphertext))

    if len(ciphertext) % 2 != 0:
        ciphertext += "X"

    matrix = generate_matrix(keyword)

    decrypted = ""
    for i in range(0, len(ciphertext), 2):
        decrypted += decrypt_pair(ciphertext[i], ciphertext[i+1], matrix)
    return decrypted

# ------------------ GUI Functions -------------------------

def animate_enter(event):
    event.widget.config(bg="#2471A3", fg="white")   # brighter blue

def animate_leave(event):
    event.widget.config(bg="#154360", fg="#d4e6f1") # darker blue

def encrypt_text():
    plaintext = entry_plain.get()
    keyword = entry_key.get()

    if not plaintext or not keyword:
        messagebox.showerror("Error", "Please enter both text and keyword.")
        return

    result = playfair_encrypt(plaintext, keyword)
    output.delete(1.0, tk.END)
    output.insert(tk.END, result)

def decrypt_text():
    ciphertext = entry_plain.get()
    keyword = entry_key.get()

    if not ciphertext or not keyword:
        messagebox.showerror("Error", "Please enter both text and keyword.")
        return

    result = playfair_decrypt(ciphertext, keyword)
    output.delete(1.0, tk.END)
    output.insert(tk.END, result)

# ------------------ Modern UI Design ----------------------------

root = tk.Tk()
root.title("Playfair Cipher â€“ Modern Dark Blue UI")
root.geometry("550x480")
root.configure(bg="#0d0d0d")     # Deep black background
root.resizable(False, False)

title = tk.Label(root, text="ðŸ” Playfair Cipher", 
                 font=("Arial", 24, "bold"),
                 fg="#5dade2", bg="#0d0d0d")
title.pack(pady=15)

frame = tk.Frame(root, bg="#0d0d0d")
frame.pack()

label1 = tk.Label(frame, text="Enter Text:", 
                  font=("Arial", 14, "bold"), 
                  bg="#0d0d0d", fg="#85c1e9")
label1.grid(row=0, column=0, padx=10, pady=10)

entry_plain = tk.Entry(frame, width=33, font=("Arial", 13), 
                       bg="#1a1a1a", fg="white",
                       insertbackground="white", relief="solid")
entry_plain.grid(row=0, column=1, padx=10)

label2 = tk.Label(frame, text="Keyword:", 
                  font=("Arial", 14, "bold"), 
                  bg="#0d0d0d", fg="#85c1e9")
label2.grid(row=1, column=0, padx=10)

entry_key = tk.Entry(frame, width=33, font=("Arial", 13), 
                     bg="#1a1a1a", fg="white",
                     insertbackground="white", relief="solid")
entry_key.grid(row=1, column=1, padx=10)

# Modern Buttons
btn_encrypt = tk.Button(root, text="Encrypt", font=("Arial", 13, "bold"),
                        bg="#154360", fg="#d4e6f1", width=15,
                        command=encrypt_text, relief="flat")
btn_encrypt.pack(pady=8)
btn_encrypt.bind("<Enter>", animate_enter)
btn_encrypt.bind("<Leave>", animate_leave)

btn_decrypt = tk.Button(root, text="Decrypt", font=("Arial", 13, "bold"),
                        bg="#154360", fg="#d4e6f1", width=15,
                        command=decrypt_text, relief="flat")
btn_decrypt.pack(pady=5)
btn_decrypt.bind("<Enter>", animate_enter)
btn_decrypt.bind("<Leave>", animate_leave)

label3 = tk.Label(root, text="Output:", 
                  font=("Arial", 16, "bold"), 
                  bg="#0d0d0d", fg="#5dade2")
label3.pack(pady=7)

output = tk.Text(root, height=7, width=55, font=("Arial", 13),
                 bg="#1a1a1a", fg="white",
                 bd=2, relief="solid")
output.pack()

root.mainloop()
